<!DOCTYPE html>
<html lang="ko">
<head>
    <link rel="shortcut icon" href="#" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§ì› ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        /* ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        h2 {
            color: #2c3e50;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
            font-weight: 300;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-container {
            text-align: center;
            margin-bottom: 25px;
        }

        button, input[type="button"] {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            margin: 5px;
        }

        button:hover, input[type="button"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        button:active, input[type="button"]:active {
            transform: translateY(0);
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-section {
            margin-bottom: 30px;
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            background: white;
            margin-bottom: 20px;
        }

        th, td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #e8e8e8;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }

        tbody tr {
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background-color: #f8f9ff;
            transform: scale(1.01);
        }

        tbody tr:nth-child(even) {
            background-color: #fafafa;
        }

        tbody tr:nth-child(even):hover {
            background-color: #f0f2ff;
        }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .form-table {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8ebff 100%);
            border: 2px solid #667eea;
        }

        .form-table td {
            padding: 12px 15px;
            vertical-align: middle;
        }

        .form-table td:first-child {
            font-weight: 600;
            color: #2c3e50;
            background-color: rgba(102, 126, 234, 0.1);
            width: 120px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        /* ë¹ˆ ë°ì´í„° ë©”ì‹œì§€ */
        .empty-data {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 40px 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8ebff 100%);
        }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loading {
            text-align: center;
            color: #667eea;
            font-weight: 600;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 20px;
            }

            h2 {
                font-size: 2rem;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: 10px 12px;
            }

            button, input[type="button"] {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
        }

        /* ì¶”ê°€ íš¨ê³¼ */
        .card-effect {
            transition: all 0.3s ease;
        }

        .card-effect:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        /* ì„±ê³µ/ì˜¤ë¥˜ ë©”ì‹œì§€ */
        .success {
            color: #27ae60;
            font-weight: 600;
        }

        .error {
            color: #e74c3c;
            font-weight: 600;
        }

        /* ì•„ì´ì½˜ íš¨ê³¼ */
        button:hover .icon, input[type="button"]:hover .icon {
            animation: bounce 0.6s ease;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-3px); }
            80% { transform: translateY(-1px); }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.10.1/sweetalert2.all.min.js"></script>
</head>
<body>
<div class="container card-effect">
    <div class="header">
        <h2>ğŸ’¼ ì§ì› ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
        <p class="subtitle">Employee Management System</p>
    </div>

    <div class="btn-container">
        <button onclick="fn_list()">
            <span class="icon">ğŸ“‹</span> ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        </button>
    </div>

    <div class="table-section">
        <h3 class="section-title">ğŸ“Š ì§ì› ëª©ë¡</h3>
        <table>
            <thead>
            <tr>
                <th>ì‚¬ë²ˆ</th>
                <th>ì´ë¦„</th>
                <th>ì„±ë³„</th>
                <th>ì£¼ì†Œ</th>
            </tr>
            </thead>
            <tbody id="my_tbody">
            <tr>
                <td colspan="4" class="empty-data">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="table-section">
        <h3 class="section-title">âœï¸ ì§ì› ì •ë³´ ì…ë ¥</h3>
        <table class="form-table card-effect">
            <tbody>
            <tr>
                <td>ğŸ‘¤ ì‚¬ë²ˆ</td>
                <td>
                    <input type="text" id="e_id" placeholder="ì§ì› ì‚¬ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”">
                </td>
            </tr>
            <tr>
                <td>ğŸ“ ì´ë¦„</td>
                <td>
                    <input type="text" id="e_name" placeholder="ì§ì› ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </td>
            </tr>
            <tr>
                <td>âš¥ ì„±ë³„</td>
                <td>
                    <input type="text" id="gen" placeholder="ì„±ë³„ì„ ì…ë ¥í•˜ì„¸ìš” (M/F)">
                </td>
            </tr>
            <tr>
                <td>ğŸ  ì£¼ì†Œ</td>
                <td>
                    <input type="text" id="addr" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </td>
            </tr>
            <tr>
                <td colspan="2" style="text-align: center; padding: 20px;">
                    <input type="button" value="â• ì§ì› ì¶”ê°€" onclick="fn_add()">
                    <input type="button" value="âœï¸ ìˆ˜ì •" onclick="fn_mod()">
                    <input type="button" value="ğŸ—‘ï¸ ì‚­ì œ" onclick="fn_delete()">
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    window.onload = function() {
        fn_list();
    }

    async function fn_add() {
        // ì…ë ¥ ê°’ ê²€ì¦
        const e_id = document.getElementById('e_id').value.trim();
        const e_name = document.getElementById('e_name').value.trim();
        const gen = document.getElementById('gen').value.trim();
        const addr = document.getElementById('addr').value.trim();

        if (!e_id || !e_name || !gen || !addr) {
            Swal.fire({
                icon: 'warning',
                title: 'ì…ë ¥ í™•ì¸',
                text: 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                confirmButtonText: 'í™•ì¸',
                confirmButtonColor: '#667eea'
            });
            return;
        }

        // í™•ì¸ ëŒ€í™”ìƒì
        const result = await Swal.fire({
            title: 'ì§ì› ì¶”ê°€',
            text: 'ìƒˆë¡œìš´ ì§ì›ì„ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#667eea',
            cancelButtonColor: '#d33',
            confirmButtonText: 'ì¶”ê°€',
            cancelButtonText: 'ì·¨ì†Œ'
        });

        if (result.isConfirmed) {
            try {
                const res = await axios.post('/emp_add.ajax', {
                    e_id: e_id,
                    e_name: e_name,
                    gen: gen,
                    addr: addr
                });

                console.log('ì„œë²„ì‘ë‹µë°ì´í„°', res.data);

                if (res.data.success) {
                    await Swal.fire({
                        icon: 'success',
                        title: 'ì„±ê³µ!',
                        text: 'ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        confirmButtonText: 'í™•ì¸',
                        confirmButtonColor: '#667eea',
                        timer: 2000,
                        timerProgressBar: true
                    });

                    fn_list();
                    clearForm();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'ì˜¤ë¥˜ ë°œìƒ',
                        text: res.data.message || 'ì§ì› ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
                        confirmButtonText: 'í™•ì¸',
                        confirmButtonColor: '#667eea'
                    });
                }
            } catch (e) {
                console.log(e);
                Swal.fire({
                    icon: 'error',
                    title: 'ì„œë²„ ì˜¤ë¥˜',
                    text: 'ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                    confirmButtonText: 'í™•ì¸',
                    confirmButtonColor: '#667eea'
                });
            }
        }
    }

    async function fn_mod() {
        // ì…ë ¥ ê°’ ê²€ì¦
        const e_id = document.getElementById('e_id').value.trim();
        const e_name = document.getElementById('e_name').value.trim();
        const gen = document.getElementById('gen').value.trim();
        const addr = document.getElementById('addr').value.trim();

        if (!e_id || !e_name || !gen || !addr) {
            Swal.fire({
                icon: 'warning',
                title: 'ì…ë ¥ í™•ì¸',
                text: 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                confirmButtonText: 'í™•ì¸',
                confirmButtonColor: '#667eea'
            });
            return;
        }

        // í™•ì¸ ëŒ€í™”ìƒì
        const result = await Swal.fire({
            title: 'ì§ì› ì •ë³´ ìˆ˜ì •',
            text: 'ì§ì› ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#667eea',
            cancelButtonColor: '#d33',
            confirmButtonText: 'ìˆ˜ì •',
            cancelButtonText: 'ì·¨ì†Œ'
        });

        if (result.isConfirmed) {
            try {
                const res = await axios.post('/emp_mod.ajax', {
                    e_id: e_id,
                    e_name: e_name,
                    gen: gen,
                    addr: addr
                });

                console.log('ì„œë²„ì‘ë‹µë°ì´í„°', res.data);

                if (res.data.success) {
                    await Swal.fire({
                        icon: 'success',
                        title: 'ìˆ˜ì • ì™„ë£Œ!',
                        text: 'ì§ì› ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        confirmButtonText: 'í™•ì¸',
                        confirmButtonColor: '#667eea',
                        timer: 2000,
                        timerProgressBar: true
                    });

                    fn_list();
                    clearForm();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'ìˆ˜ì • ì‹¤íŒ¨',
                        text: res.data.message || 'ì§ì› ì •ë³´ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
                        confirmButtonText: 'í™•ì¸',
                        confirmButtonColor: '#667eea'
                    });
                }
            } catch (e) {
                console.log(e);
                Swal.fire({
                    icon: 'error',
                    title: 'ì„œë²„ ì˜¤ë¥˜',
                    text: 'ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                    confirmButtonText: 'í™•ì¸',
                    confirmButtonColor: '#667eea'
                });
            }
        }
    }

    async function fn_delete() {
        const e_id = document.getElementById('e_id').value.trim();

        if (!e_id) {
            Swal.fire({
                icon: 'warning',
                title: 'ì‚¬ë²ˆ í™•ì¸',
                text: 'ì‚­ì œí•  ì§ì›ì˜ ì‚¬ë²ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                confirmButtonText: 'í™•ì¸',
                confirmButtonColor: '#667eea'
            });
            return;
        }

        // ì‚­ì œ í™•ì¸ ëŒ€í™”ìƒì
        const result = await Swal.fire({
            title: 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
            text: "ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#667eea',
            confirmButtonText: 'ì‚­ì œ',
            cancelButtonText: 'ì·¨ì†Œ'
        });

        if (result.isConfirmed) {
            try {
                const res = await axios.post('/emp_del.ajax', {
                    e_id: e_id
                });

                if (res.data.success) {
                    await Swal.fire({
                        icon: 'success',
                        title: 'ì‚­ì œ ì™„ë£Œ!',
                        text: 'ì§ì› ì •ë³´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.',
                        confirmButtonText: 'í™•ì¸',
                        confirmButtonColor: '#667eea',
                        timer: 2000,
                        timerProgressBar: true
                    });

                    fn_list();
                    clearForm();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'ì‚­ì œ ì‹¤íŒ¨',
                        text: res.data.message || 'ì§ì› ì •ë³´ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
                        confirmButtonText: 'í™•ì¸',
                        confirmButtonColor: '#667eea'
                    });
                }
            } catch (e) {
                console.log(e);
                Swal.fire({
                    icon: 'error',
                    title: 'ì„œë²„ ì˜¤ë¥˜',
                    text: 'ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                    confirmButtonText: 'í™•ì¸',
                    confirmButtonColor: '#667eea'
                });
            }
        }
    }

    async function fn_one(e_id) {
        console.log("e_id: ", e_id);

        try {
            const res = await axios.get(`/emp_detail.ajax`, {
                params: { e_id: e_id }
            });

            console.log('ì„œë²„ì‘ë‹µë°ì´í„°', res.data.emp);

            if (!res.data) {
                throw new Error("ì„œë²„ë¡œë¶€í„° ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤");
            }
            if (!res.data.success) {
                throw new Error(res.data.message || 'ë°ì´í„° ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            if (!res.data.emp) {
                throw new Error('ì§ì› ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }

            const emp = res.data.emp;
            document.getElementById('e_id').value = emp.e_id;
            document.getElementById('e_name').value = emp.e_name;
            document.getElementById('gen').value = emp.gen;
            document.getElementById('addr').value = emp.addr;

            // ë°ì´í„° ë¡œë“œ ì„±ê³µ ì•Œë¦¼
            const toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 1500,
                timerProgressBar: true
            });

            toast.fire({
                icon: 'info',
                title: 'ì§ì› ì •ë³´ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.'
            });

        } catch (error) {
            console.error('ìƒì„¸ ë°ì´í„° ì¡°íšŒ ì˜¤ë¥˜:', error);
            Swal.fire({
                icon: 'error',
                title: 'ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨',
                text: error.message || 'ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                confirmButtonText: 'í™•ì¸',
                confirmButtonColor: '#667eea'
            });
        }
    }

    async function fn_list() {
        try {
            // ë¡œë”© í‘œì‹œ
            document.getElementById('my_tbody').innerHTML = `
                <tr>
                    <td colspan="4" class="empty-data">
                        <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</div>
                    </td>
                </tr>
            `;

            const response = await axios.get('/emp_list.ajax');
            console.log('ì„œë²„ì‘ë‹µë°ì´í„°', response.data);

            const { success, empList, message } = response.data;
            const tbody = document.getElementById('my_tbody');

            if (success && empList && empList.length > 0) {
                tbody.innerHTML = '';

                empList.forEach(emp => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong><a href="javascript:fn_one('${emp.e_id}')">${emp.e_id}</a></strong></td>
                        <td>${emp.e_name}</td>
                        <td><span style="padding: 4px 8px; background: ${emp.gen === 'M' ? '#e3f2fd' : '#fce4ec'}; border-radius: 12px; font-size: 0.9rem;">${emp.gen === 'M' ? 'ğŸ‘¨ ë‚¨ì„±' : emp.gen === 'F' ? 'ğŸ‘© ì—¬ì„±' : emp.gen}</span></td>
                        <td>${emp.addr || '<span style="color: #bdc3c7; font-style: italic;">ì£¼ì†Œ ì •ë³´ ì—†ìŒ</span>'}</td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-data">
                            ğŸ“‹ ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤<br>
                            <small style="color: #95a5a6;">ìƒˆ ì§ì›ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</small>
                        </td>
                    </tr>
                `;
            }
        } catch (error) {
            console.error('ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
            document.getElementById('my_tbody').innerHTML = `
                <tr>
                    <td colspan="4" class="empty-data error">
                        âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨<br>
                        <small>ì„œë²„ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”</small>
                    </td>
                </tr>
            `;

            Swal.fire({
                icon: 'error',
                title: 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨',
                text: 'ì„œë²„ì—ì„œ ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                confirmButtonText: 'í™•ì¸',
                confirmButtonColor: '#667eea'
            });
        }
    }

    // í¼ ì´ˆê¸°í™” í•¨ìˆ˜
    function clearForm() {
        document.getElementById('e_id').value = '';
        document.getElementById('e_name').value = '';
        document.getElementById('gen').value = '';
        document.getElementById('addr').value = '';
    }
</script>
</body>
</html>